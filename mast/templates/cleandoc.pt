<metal:main use-macro="load: admin.pt">
<div metal:fill-slot="content">
    <div class="row">
        <section class="slot-6-7-8">
            <h2>Add Document Names</h2>
        </section>
    </div>
    <div class="row dashboard">
        <section class="slot-6-7">
            <div tal:condition="doc['dtype'] == 'pet'">
            <form action="#" method="POST">
                <h3>Transcribe ${doc['cnt']} ${'Petition Signature' if doc['dtype'] == 'pet' else 'Applicant Name'}${'s' if doc['cnt'] > 1 else ''}</h3>
                <p class="note" style="padding-bottom:1.1em">Using the document view on the right, try to enter the information on the form that you can read as best you can.  Hitting "Save" will update this record.  "Cancel" will discard any unsaved changes.  You do not have to enter every name in order to save.</p>
                <table class="entrygrid" width="100%">
                <tr>
                    <td class="name">Full Name</td>
                    <td class="addr">Address</td>
                    <td class="contact">Email</td>
                    <td class="contact">Phone</td>
                </tr>
                <?python 
                    docnames = doc['names'] if 'names' in doc else [] 
                    dnlen = len(docnames)
                ?>
                <tr tal:repeat="ind python:range(doc['cnt'])">
                    <td class="name"><input type="text" name="name${ind}" value="${docnames[ind]['n'] if dnlen > ind else ''}"/></td>
                    <td class="name"><input type="text" name="addr${ind}" value="${docnames[ind]['a'] if dnlen > ind else ''}"/></td>
                    <td class="name"><input type="text" name="phone${ind}" value="${docnames[ind]['ph'] if dnlen > ind else ''}"/></td>
                    <td class="name"><input type="text" name="email${ind}" value="${docnames[ind]['em'] if dnlen > ind else ''}"/></td>
                </tr>
                </table>
                <div class="buttons">
                    <button class="submit" submit="true">Submit</button>
                    <a class="cancel" href="/admin/clean.html">Cancel</a>
                </div>
            </form>
            </div>
            <div tal:condition="doc['dtype'] == 'app'">
            <p>This is for review only.  No action is required for pre-application forms.</p>
            </div>
        </section>
        <section class="slot-8-9">
            <?python
                preview_url = '/upload/view/'+str(doc['_id'])
                preview_url += doc['ext'] if 'ext' in doc else '.jpeg'
            ?>
            <p>Document Preview <em class="note">if you don't see a preview below then <a href="${preview_url if preview_url is not None else '/static/images/blank.gif'}" target="previewdoc">click here</a></em></p>
            <div class="toolbar"><a class="lrotate" title="Rotate Left"></a><a class="rrotate" title="Rotate Right"></a><a title="Change Zoom" class="zoom">50%</a><a title="Move Image" class="move"></a></div>
            <div class="preview" style="border:solid #999 1px;height:550px;width:100%;overflow:hidden"><canvas id="previewCanvas"></canvas></div>
        </section>
    </div>
    <script>
    jQuery(function($) {
        var canvas = document.getElementById('previewCanvas');
        var ctx = canvas.getContext('2d');
        // load image from data url
        var imageObj = new Image();
        imageObj.onload = function(){
            canvas.width = this.width;
            canvas.height = this.height;
            ctx.scale(1.25,1.25);
            //ctx.drawImage(this,0,0);
            var w2 = this.width / 2;
            var h2 = this.height / 2;
            ctx.translate(h2,w2);
            //ctx.translate(w2,h2);
            ctx.rotate(1.58);
            ctx.drawImage(this, -w2, -h2);
        };
     
        imageObj.src = '${preview_url if preview_url is not None else 'blank.gif'}';
    });
    </script>
</div>
</metal:main>
